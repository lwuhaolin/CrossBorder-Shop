<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.crossborder.shop.mapper.SellerStatsMapper">

    <select id="countTotalProducts" resultType="long">
        SELECT COUNT(*)
        FROM tb_product
        WHERE deleted = 0 AND seller_id = #{sellerId}
    </select>

    <select id="countActiveProducts" resultType="long">
        SELECT COUNT(*)
        FROM tb_product
        WHERE deleted = 0 AND seller_id = #{sellerId} AND status = 1
    </select>

    <select id="countTotalOrders" resultType="long">
        SELECT COUNT(*)
        FROM tb_order
        WHERE deleted = 0 AND seller_id = #{sellerId}
    </select>

    <select id="countPendingOrders" resultType="long">
        SELECT COUNT(*)
        FROM tb_order
        WHERE deleted = 0 AND seller_id = #{sellerId} AND order_status IN (0, 1)
    </select>

    <select id="countCompletedOrders" resultType="long">
        SELECT COUNT(*)
        FROM tb_order
        WHERE deleted = 0 AND seller_id = #{sellerId} AND order_status = 3
    </select>

    <select id="sumTotalRevenue" resultType="java.math.BigDecimal">
        SELECT IFNULL(SUM(total_amount), 0)
        FROM tb_order
        WHERE deleted = 0 AND seller_id = #{sellerId} AND payment_status = 1
    </select>

    <select id="sumRevenueToday" resultType="java.math.BigDecimal">
        SELECT IFNULL(SUM(total_amount), 0)
        FROM tb_order
        WHERE deleted = 0 AND seller_id = #{sellerId} AND payment_status = 1
          AND DATE(payment_time) = CURDATE()
    </select>

    <select id="sumRevenueThisMonth" resultType="java.math.BigDecimal">
        SELECT IFNULL(SUM(total_amount), 0)
        FROM tb_order
        WHERE deleted = 0 AND seller_id = #{sellerId} AND payment_status = 1
          AND YEAR(payment_time) = YEAR(CURDATE())
          AND MONTH(payment_time) = MONTH(CURDATE())
    </select>

    <select id="countTotalSales" resultType="long">
        SELECT IFNULL(SUM(quantity), 0)
        FROM tb_order_item
        WHERE order_id IN (
            SELECT id FROM tb_order
            WHERE deleted = 0 AND seller_id = #{sellerId} AND payment_status = 1
        )
    </select>

</mapper>
